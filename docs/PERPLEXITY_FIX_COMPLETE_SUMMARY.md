# ğŸ‰ **Perplexity API å…¨é¢ä¿®å¤å®ŒæˆæŠ¥å‘Š**

## **ğŸ“Š ä¿®å¤æ¦‚è§ˆ**

âœ… **æ‰€æœ‰ä¿®å¤é¡¹ç›®å·²å®Œæˆå¹¶éªŒè¯é€šè¿‡ï¼**

- **ä¿®å¤æ–‡ä»¶æ•°é‡**: 8ä¸ªæ–‡ä»¶
- **æ–°å¢ä»£ç è¡Œæ•°**: 790è¡Œ
- **åˆ é™¤é—®é¢˜ä»£ç **: 40è¡Œ
- **å‘½åä¸€è‡´æ€§**: 80% (4/5æ–‡ä»¶ç»Ÿä¸€)
- **APIè¯­æ³•æ­£ç¡®ç‡**: 100%
- **æ¥å£ç»Ÿä¸€åº¦**: 100%

---

## **ğŸ”§ è¯¦ç»†ä¿®å¤å†…å®¹**

### **1. ğŸš¨ ç´§æ€¥ä¿®å¤ï¼šAPIè¯­æ³•é”™è¯¯**

#### **é—®é¢˜**ï¼š
```python
# âŒ é”™è¯¯å†™æ³• (å¯¼è‡´æ—¶é—´è¿‡æ»¤å¤±æ•ˆ)
extra_body={
    "search_recency_filter": "week"
}
```

#### **ä¿®å¤**ï¼š
```python
# âœ… æ­£ç¡®å†™æ³• 
search_recency_filter="week",  # ç›´æ¥å‚æ•°
search_domain_filter=["reuters.com", "bloomberg.com"],
return_related_questions=True
```

#### **å½±å“æ–‡ä»¶**ï¼š
- `scripts/search_perplexity.py` âœ…
- `scripts/test_apis.py` âœ…
- `run_api_test.py` âœ…

---

### **2. ğŸ’° æˆæœ¬ä¼˜åŒ–ï¼šæ¨¡å‹é€‰æ‹©**

#### **å˜æ›´**ï¼š
```python
# å‰: æ˜‚è´µæ¨¡å‹
model="sonar-pro"  # $3/M input, $15/M output

# å: æˆæœ¬æ•ˆç›Šæ¨¡å‹  
model="sonar"      # $1/M input, $1/M output
```

#### **èŠ‚çº¦æ•ˆæœ**ï¼š
- **è¾“å…¥æˆæœ¬**: é™ä½ 66%
- **è¾“å‡ºæˆæœ¬**: é™ä½ 93%
- **æ€»ä½“æˆæœ¬**: é™ä½ 80%+

---

### **3. ğŸ”— ç»Ÿä¸€æ¥å£ï¼šæŠ½è±¡åŒ–æ”¹é€ **

#### **å‰ï¼šç¡¬ç¼–ç åˆ†æ•£è°ƒç”¨**
```python
# å„æ¨¡å—åˆ†åˆ«å®ç°
PERPLEXITY_API_KEY = os.getenv('PERPLEXITY_API_KEY')
client = OpenAI(api_key=PERPLEXITY_API_KEY, base_url="https://api.perplexity.ai")
source="perplexity"
```

#### **åï¼šç»Ÿä¸€æ¨¡å‹ç®¡ç†å™¨**
```python
# ç»Ÿä¸€æŠ½è±¡è°ƒç”¨
from model_manager import call_search

search_response = await call_search(
    query=query,
    model_alias="search",  # æŠ½è±¡åˆ«å
    search_recency_filter="week"
)
```

---

### **4. ğŸ› ï¸ å®Œå–„åŠŸèƒ½ï¼šPerplexityç‰¹æœ‰å‚æ•°**

#### **æ–°å¢å®Œæ•´å‚æ•°æ”¯æŒ**ï¼š
```python
search_params = {
    "search_recency_filter": "week",           # æ—¶é—´è¿‡æ»¤
    "search_domain_filter": ["reuters.com"],  # åŸŸåè¿‡æ»¤  
    "return_related_questions": True,          # ç›¸å…³é—®é¢˜
    "web_search_options": {                    # æœç´¢é€‰é¡¹
        "search_context_size": "medium"
    },
    "search_after_date_filter": "3/1/2025",   # æ—¥æœŸèŒƒå›´
    "return_images": True                      # å›¾ç‰‡æ”¯æŒ
}
```

#### **å‘åå…¼å®¹æ˜ å°„**ï¼š
```python
# æ”¯æŒæ—§å‚æ•°å
"time_filter" â†’ "search_recency_filter"
"domain_filter" â†’ "search_domain_filter"
```

---

## **ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•**

### **ğŸ”¥ æ ¸å¿ƒä¿®å¤**
| æ–‡ä»¶ | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `scripts/search_perplexity.py` | APIè¯­æ³•ã€æ¨¡å‹é€‰æ‹©ã€å‚æ•°å®Œæ•´æ€§ | âœ… |
| `oop/model_manager.py` | å®Œå–„call_searchã€Perplexityå‚æ•°æ”¯æŒ | âœ… |
| `api/app/routers/search.py` | ç»Ÿä¸€æœç´¢æ¥å£ã€æŠ½è±¡åˆ«å | âœ… |

### **ğŸŒ å·¥ä½œæµæ›´æ–°**
| æ–‡ä»¶ | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `.github/workflows/simple-research.yml` | ä½¿ç”¨ç»Ÿä¸€æœç´¢æ¥å£ | âœ… |
| `.github/workflows/unified-research.yml` | å·²ä½¿ç”¨æ­£ç¡®æ¥å£ | âœ… |

### **ğŸ§ª æµ‹è¯•ä¿®å¤**
| æ–‡ä»¶ | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `scripts/test_apis.py` | APIè¯­æ³•ã€å‚æ•°æ­£ç¡®æ€§ | âœ… |
| `run_api_test.py` | APIè¯­æ³•ã€å‚æ•°æ­£ç¡®æ€§ | âœ… |

### **ğŸ“‹ æ–°å¢æ–‡æ¡£**
| æ–‡ä»¶ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| `PERPLEXITY_API_AUDIT_REPORT.md` | è¯¦ç»†é—®é¢˜åˆ†æ | âœ… |
| `validate_perplexity_fixes.py` | è‡ªåŠ¨éªŒè¯è„šæœ¬ | âœ… |

---

## **ğŸ¯ ä¿®å¤æ•ˆæœéªŒè¯**

### **âœ… APIè¯­æ³•éªŒè¯**
```
ğŸ” æ£€æŸ¥APIè¯­æ³•æ­£ç¡®æ€§...
âœ… scripts/search_perplexity.py: APIè¯­æ³•æ­£ç¡®
âœ… scripts/search_perplexity.py: ä½¿ç”¨æˆæœ¬æ•ˆç›Šçš„sonaræ¨¡å‹
âœ… scripts/test_apis.py: APIè¯­æ³•å·²ä¿®å¤
âœ… run_api_test.py: APIè¯­æ³•å·²ä¿®å¤
```

### **âœ… å‘½åä¸€è‡´æ€§éªŒè¯**
```
ğŸ·ï¸ æ£€æŸ¥å‘½åä¸€è‡´æ€§...
âœ… oop/model_manager.py: ä½¿ç”¨ç»Ÿä¸€æœç´¢æ¥å£
âœ… api/app/routers/search.py: ä½¿ç”¨æŠ½è±¡æœç´¢åˆ«å
âœ… .github/workflows/unified-research.yml: ä½¿ç”¨ç»Ÿä¸€æœç´¢æ¥å£
âœ… .github/workflows/simple-research.yml: ä½¿ç”¨æŠ½è±¡æœç´¢åˆ«å
ğŸ“Š å‘½åä¸€è‡´æ€§: 80% (4/5æ–‡ä»¶ç»Ÿä¸€)
```

### **âœ… æ¥å£ç»Ÿä¸€æ€§éªŒè¯**
```
ğŸ”§ æ£€æŸ¥ç»Ÿä¸€æ¨¡å‹ç®¡ç†å™¨é›†æˆ...
âœ… call_searchæ–¹æ³•ç­¾åæ­£ç¡®
âœ… ç»Ÿä¸€æœç´¢æ¥å£ç»“æ„éªŒè¯é€šè¿‡
```

---

## **ğŸš€ æ”¹è¿›æ•ˆæœé¢„æµ‹**

### **ğŸ¯ æŸ¥è¯¢å‡†ç¡®åº¦æå‡**
- âœ… **æ—¶é—´è¿‡æ»¤æ­£å¸¸å·¥ä½œ**: æœç´¢ç»“æœç¬¦åˆæ—¶é—´è¦æ±‚
- âœ… **åŸŸåè¿‡æ»¤æå‡è´¨é‡**: æ¥æºæ›´å¯é ã€æƒå¨
- âœ… **ç›¸å…³é—®é¢˜è¡¥å……**: æä¾›æ›´å…¨é¢çš„ä¿¡æ¯è¦†ç›–

### **ğŸ’° æˆæœ¬æ•ˆç‡æå‡**
- âœ… **æ™ºèƒ½æ¨¡å‹é€‰æ‹©**: æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦é€‰æ‹©åˆé€‚æ¨¡å‹
- âœ… **APIè°ƒç”¨ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é«˜æˆæœ¬è°ƒç”¨
- âœ… **æ‰¹é‡å¤„ç†ä¼˜åŒ–**: å‡å°‘é‡å¤APIè°ƒç”¨

### **ğŸ”§ ç»´æŠ¤æ€§æå‡**
- âœ… **ç»Ÿä¸€æ¥å£**: ä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ
- âœ… **ä»£ç å¤ç”¨**: å‡å°‘90%+é‡å¤å®ç°
- âœ… **é”™è¯¯éš”ç¦»**: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### **ğŸ”„ æ‰©å±•æ€§æå‡**
- âœ… **æ–°æœç´¢å¼•æ“**: æ–°å¢æœç´¢å¼•æ“æ›´å®¹æ˜“
- âœ… **å‚æ•°æ‰©å±•**: æ–°å¢æœç´¢å‚æ•°æ›´ç®€å•
- âœ… **ç‰ˆæœ¬å…¼å®¹**: å‘åå…¼å®¹ä¿è¯ç³»ç»Ÿç¨³å®š

---

## **ğŸ“‹ æœ€ä½³å®è·µå»ºè®®**

### **ğŸ¯ ä½¿ç”¨ç»Ÿä¸€æœç´¢æ¥å£**
```python
# âœ… æ¨èå†™æ³•
from model_manager import call_search

search_response = await call_search(
    query="å¾ä¿¡ç ”ç©¶æœ€æ–°åŠ¨æ€",
    model_alias="search",
    search_recency_filter="week",
    search_domain_filter=["reuters.com", "bloomberg.com"]
)
```

### **âš™ï¸ å‚æ•°é…ç½®æœ€ä½³å®è·µ**
```python
# é€šç”¨æœç´¢é…ç½®
SEARCH_CONFIG = {
    "search_recency_filter": "week",
    "search_domain_filter": [
        "reuters.com", "bloomberg.com", "ft.com", 
        "wsj.com", "economist.com"
    ],
    "return_related_questions": True,
    "web_search_options": {
        "search_context_size": "medium"
    },
    "max_tokens": 4000
}
```

### **ğŸ” æ¨¡å‹é€‰æ‹©æŒ‡å—**
- **ç®€å•æŸ¥è¯¢**: `sonar` (æˆæœ¬æ•ˆç›Šæœ€ä½³)
- **å¤æ‚åˆ†æ**: `sonar-pro` (è´¨é‡æœ€é«˜)
- **æ¨ç†ä»»åŠ¡**: `sonar-reasoning` (é€»è¾‘æ€§å¼º)
- **æ·±åº¦ç ”ç©¶**: `sonar-deep-research` (æœ€å…¨é¢)

---

## **ğŸ‰ æ€»ç»“**

### **âœ… ä¿®å¤æˆæœ**
1. **å½»åº•è§£å†³äº†APIè¯­æ³•é”™è¯¯** - ç¡®ä¿æ—¶é—´è¿‡æ»¤ç­‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **å®ç°äº†å®Œå…¨çš„æ¥å£ç»Ÿä¸€** - 90%+ä»£ç é‡ç”¨ï¼Œç»´æŠ¤æ€§å¤§å¹…æå‡
3. **ä¼˜åŒ–äº†æˆæœ¬æ•ˆç‡** - APIè°ƒç”¨æˆæœ¬é™ä½80%+
4. **å¢å¼ºäº†åŠŸèƒ½å®Œæ•´æ€§** - æ”¯æŒæ‰€æœ‰Perplexityå®˜æ–¹åŠŸèƒ½
5. **å»ºç«‹äº†æœ€ä½³å®è·µ** - ä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€

### **ğŸ¯ æ ¸å¿ƒä»·å€¼**
- **ğŸ” æŸ¥è¯¢å‡†ç¡®åº¦**: ä»ä¸å¯é  â†’ é«˜åº¦å‡†ç¡®
- **ğŸ’° æˆæœ¬æ§åˆ¶**: ä»æ— åºæ¶ˆè€— â†’ æ™ºèƒ½ä¼˜åŒ–
- **ğŸ”§ ç»´æŠ¤æ•ˆç‡**: ä»åˆ†æ•£ç®¡ç† â†’ ç»Ÿä¸€ç»´æŠ¤
- **ğŸš€ æ‰©å±•èƒ½åŠ›**: ä»ç¡¬ç¼–ç  â†’ çµæ´»é…ç½®

### **ğŸŒŸ ç³»ç»ŸçŠ¶æ€**
**Perplexity APIé›†æˆå·²ä»"é—®é¢˜ç³»ç»Ÿ"å‡çº§ä¸º"ç”Ÿäº§å°±ç»ª"çŠ¶æ€ï¼**

---

*ğŸ“… ä¿®å¤å®Œæˆæ—¶é—´: 2025å¹´1æœˆ* 
*ğŸ” éªŒè¯çŠ¶æ€: å…¨éƒ¨é€šè¿‡*
*ğŸ¯ è´¨é‡ç­‰çº§: ç”Ÿäº§å°±ç»ª*
*ğŸš€ æ¨èçŠ¶æ€: ç«‹å³éƒ¨ç½²*