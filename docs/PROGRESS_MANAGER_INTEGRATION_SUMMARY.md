# Progress Manager é›†æˆå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„é›†æˆå·¥ä½œ

### 1. **æ¨¡å—é‡å‘½å** âœ…
- **æ–‡ä»¶**: `progress_cost_manager.py` â†’ `progress_manager.py`
- **åŠŸèƒ½**: çº¯Tokenè®¡ç®—ï¼Œç§»é™¤æ‰€æœ‰ä»·æ ¼ç›¸å…³é€»è¾‘
- **ç‰¹ç‚¹**: 
  - ğŸ”¢ Tokenä¼°ç®—å’Œè¿½è¸ª
  - ğŸ“Š å®æ—¶è¿›åº¦æ¡
  - ğŸ“ˆ å‡†ç¡®åº¦è¯„ä¼°
  - ğŸ“„ æ—¥å¿—è®°å½•

### 2. **æ‰‹åŠ¨è®­ç»ƒé›†æˆ** âœ…
- **æ–‡ä»¶**: `manual_chromadb_trainer.py`
- **é›†æˆç‚¹**: Tokenä¼°ç®— â†’ ç”¨æˆ·ç¡®è®¤ â†’ è®­ç»ƒæ‰§è¡Œ
- **æµç¨‹**:
  ```
  ğŸ“Š æ–‡ä»¶åˆ†æ â†’ ğŸ”¢ Tokenä¼°ç®— â†’ â“ ç”¨æˆ·ç¡®è®¤ â†’ ğŸš€ å¼€å§‹è®­ç»ƒ
  â”œâ”€â”€ é¢„ä¼°è¾“å…¥tokens
  â”œâ”€â”€ é¢„ä¼°APIè°ƒç”¨æ¬¡æ•°  
  â”œâ”€â”€ ç”¨æˆ·æ‰¹å‡†/å–æ¶ˆé€‰é¡¹
  â””â”€â”€ å®æ—¶è¿›åº¦è¿½è¸ª + Tokenè®°å½•
  ```

#### ç”¨æˆ·äº¤äº’ç•Œé¢:
```
ğŸ’° è®­ç»ƒæˆæœ¬ä¼°ç®—
==================================================
ğŸ“ å¾…å¤„ç†æ–‡ä»¶: 3
ğŸ”¢ é¢„ä¼°tokens: 1,500
ğŸ“ é¢„ä¼°APIè°ƒç”¨: 6
ğŸ’¡ æç¤º: ä¸»è¦æˆæœ¬æ¥è‡ªåƒé—®APIçš„æ–‡æœ¬åˆ‡åˆ†å’Œå‘é‡åŒ–
==================================================

â“ æ˜¯å¦ç»§ç»­è®­ç»ƒ? (y/N): y
âœ… ç”¨æˆ·ç¡®è®¤ï¼Œå¼€å§‹è®­ç»ƒ...

ğŸ“„ [1/3] å¤„ç†: document1.txt
ğŸ“„ [2/3] å¤„ç†: document2.txt  
ğŸ“„ [3/3] å¤„ç†: document3.txt

ğŸ“Š Tokenä½¿ç”¨æŠ¥å‘Š:
   Tokenä¼°ç®—å‡†ç¡®åº¦: 95.2%
   å®é™…tokens: 1,428
```

### 3. **æ—¥å¸¸æœç´¢é›†æˆ** âœ…
- **æ–‡ä»¶**: `.github/workflows/simple-research.yml`
- **é›†æˆç‚¹**: æœç´¢æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è‡ªåŠ¨Tokenè®°å½•
- **ç‰¹ç‚¹**: 
  - ğŸ”„ æ— éœ€ç”¨æˆ·æ‰¹å‡†
  - ğŸ“ è‡ªåŠ¨è®°å½•æ—¥å¿—
  - ğŸ“Š å®æ—¶è¿›åº¦æ˜¾ç¤º
  - ğŸ“ˆ å‡†ç¡®åº¦è¯„ä¼°

#### æœç´¢Tokenè®°å½•ç¤ºä¾‹:
```
ğŸ” æœç´¢ä¸»é¢˜: ä¿¡ç”¨é£é™©ç®¡ç† (æ—¶é—´èŒƒå›´: week)
   âœ… æˆåŠŸè·å–ç»“æœ (å¼•ç”¨æ•°: 5)

ğŸ” æœç´¢ä¸»é¢˜: ESGè¯„çº§ (æ—¶é—´èŒƒå›´: week)  
   âœ… æˆåŠŸè·å–ç»“æœ (å¼•ç”¨æ•°: 3)

ğŸ¯ æœç´¢å®Œæˆï¼Œå…±è·å¾— 2 ä¸ªç»“æœ

ğŸ“Š Tokenä½¿ç”¨æŠ¥å‘Š:
   Tokenä¼°ç®—å‡†ç¡®åº¦: 78.5%
   å®é™…tokens: 5,240
   Tokenæ—¥å¿—å·²ä¿å­˜: search_token_log_20241201_143052.json
```

---

## ğŸ”§ é›†æˆçš„å…³é”®åŠŸèƒ½

### **1. Tokenä¼°ç®—ç®—æ³•**
```python
# æœç´¢Tokenä¼°ç®—
estimated_input_tokens = len(' '.join(topics)) * 50
estimated_output_tokens = len(topics) * 2500

# è®­ç»ƒTokenä¼°ç®—  
estimated_input_tokens = int(total_chars / 2.5)  # 1 token â‰ˆ 2.5ä¸­æ–‡å­—ç¬¦
api_calls = total_files * 2  # åˆ‡åˆ† + å‘é‡åŒ–
```

### **2. ç”¨æˆ·ç¡®è®¤æœºåˆ¶**
```python
def request_user_confirmation(self, estimate: Dict) -> bool:
    print("ğŸ’° è®­ç»ƒæˆæœ¬ä¼°ç®—")
    print(f"ğŸ“ å¾…å¤„ç†æ–‡ä»¶: {estimate['total_files']}")
    print(f"ğŸ”¢ é¢„ä¼°tokens: {estimate['total_tokens']:,}")
    
    while True:
        user_input = input("â“ æ˜¯å¦ç»§ç»­è®­ç»ƒ? (y/N): ").strip().lower()
        if user_input in ['y', 'yes']:
            return True
        elif user_input in ['n', 'no', '']:
            return False
```

### **3. è¿›åº¦è¿½è¸ª**
```python
# å®æ—¶è¿›åº¦æ¡
progress_manager.update_progress(
    task_id=task_id,
    processed_items=i + 1,
    current_item=file_path.name,
    increment=True
)

# Tokenä½¿ç”¨è®°å½•
progress_manager.log_api_usage(
    task_id=task_id,
    api_provider="qwen",
    model="text-embedding-v2", 
    input_tokens=file_tokens,
    success=True
)
```

---

## ğŸ“ ä¸¤ç§ä¸åŒçš„ä½¿ç”¨æ¨¡å¼

### **æ¨¡å¼1: æ‰‹åŠ¨è®­ç»ƒ (éœ€è¦ç”¨æˆ·ç¡®è®¤)**
```bash
# æ‰§è¡Œæ‰‹åŠ¨è®­ç»ƒ
python manual_chromadb_trainer.py

# æµç¨‹:
1. ğŸ” æ‰«ætraindbæ–‡ä»¶å¤¹
2. ğŸ“Š åˆ†ææ–‡ä»¶å¹¶ä¼°ç®—Tokenæ¶ˆè€—
3. â“ æ˜¾ç¤ºæˆæœ¬ä¼°ç®—ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
4. âœ… ç”¨æˆ·ç¡®è®¤åå¼€å§‹è®­ç»ƒ
5. ğŸ“ˆ å®æ—¶æ˜¾ç¤ºè¿›åº¦æ¡å’ŒTokenè®°å½•
6. ğŸ“Š ç”ŸæˆTokenä½¿ç”¨æŠ¥å‘Šå’Œå‡†ç¡®åº¦è¯„ä¼°
```

### **æ¨¡å¼2: æ—¥å¸¸æœç´¢ (è‡ªåŠ¨è®°å½•)**  
```bash
# GitHub Actionsè‡ªåŠ¨æ‰§è¡Œ
workflow_dispatch: Simple Research Automation

# æµç¨‹:
1. ğŸ” æ‰§è¡ŒPerplexityæœç´¢  
2. ğŸ”¢ è‡ªåŠ¨ä¼°ç®—Tokenæ¶ˆè€—
3. ğŸ“ å®æ—¶è®°å½•å®é™…Tokenä½¿ç”¨
4. ğŸ“Š å®Œæˆåç”ŸæˆTokenä½¿ç”¨æŠ¥å‘Š
5. ğŸ’¾ ä¿å­˜Tokenæ—¥å¿—åˆ°æ–‡ä»¶
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹æ€»ç»“

### âœ… **ä¼˜åŠ¿**
- **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰APIä»»åŠ¡ä½¿ç”¨ç›¸åŒçš„Tokenç®¡ç†
- **å‡†ç¡®ä¼°ç®—**: åŸºäºå®é™…æ–‡æœ¬é•¿åº¦çš„Tokenä¼°ç®—
- **å®æ—¶ç›‘æ§**: è¿›åº¦æ¡ + å®æ—¶Tokenè®¡æ•°
- **æˆæœ¬é€æ˜**: ä¼°ç®—vså®é™…çš„å‡†ç¡®åº¦è¯„ä¼°
- **çµæ´»æ§åˆ¶**: æ‰‹åŠ¨ç¡®è®¤ vs è‡ªåŠ¨è®°å½•ä¸¤ç§æ¨¡å¼

### ğŸ“Š **ç›‘æ§æŒ‡æ ‡**
- Tokenä¼°ç®—å‡†ç¡®åº¦
- å®é™…Tokenæ¶ˆè€—ï¼ˆè¾“å…¥+è¾“å‡ºï¼‰
- APIè°ƒç”¨æˆåŠŸç‡
- ä»»åŠ¡æ‰§è¡Œæ—¶é—´
- è¿›åº¦å®Œæˆç™¾åˆ†æ¯”

### ğŸ’¡ **ç”¨æˆ·ä½“éªŒ**
- æ‰‹åŠ¨è®­ç»ƒ: å…ˆçœ‹æˆæœ¬ï¼Œå†å†³å®šæ˜¯å¦æ‰§è¡Œ
- æ—¥å¸¸æœç´¢: é€æ˜è®°å½•ï¼Œæ— éœ€å¹²é¢„
- å®æ—¶åé¦ˆ: è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰çŠ¶æ€
- å†å²è¿½è¸ª: Tokenä½¿ç”¨æ—¥å¿—æ–‡ä»¶

---

## ğŸ“‹ å¾…å®Œæˆäº‹é¡¹

### ğŸ”® **ä¸‹ä¸€æ­¥è®¡åˆ’**
1. **Perplexityè¯·æ±‚ä¸Šé™è®¾ç½®**: æ§åˆ¶å•æ¬¡æœç´¢çš„æœ€å¤§Tokenæ¶ˆè€—
2. **æ–‡æœ¬åˆ‡åˆ†ä¼˜åŒ–**: ä¼˜åŒ–æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥ä»¥é™ä½Tokenæˆæœ¬
3. **æ›´æ–°å…¶ä»–å¼•ç”¨**: æ£€æŸ¥å¹¶æ›´æ–°å…¶ä»–æ–‡ä»¶ä¸­çš„progress_managerå¼•ç”¨

è¿™æ ·ï¼Œæ‚¨çš„ç³»ç»Ÿç°åœ¨å…·å¤‡äº†å®Œæ•´çš„Tokenæ¶ˆè€—ç®¡ç†èƒ½åŠ›ï¼Œæ—¢èƒ½åœ¨å…³é”®è®­ç»ƒä»»åŠ¡å‰è·å¾—ç”¨æˆ·åŒæ„ï¼Œä¹Ÿèƒ½åœ¨æ—¥å¸¸æœç´¢ä¸­é€æ˜åœ°è®°å½•èµ„æºä½¿ç”¨æƒ…å†µï¼ğŸš€