# 征信研究系统完整试跑指南

## 🖥️ FastAPI vs GitHub Actions 运行环境

### **运行环境对比**

| 功能 | 本机FastAPI | GitHub Actions |
|------|-------------|----------------|
| **用途** | 开发调试、本地测试 | 生产环境、自动化工作流 |
| **启动方式** | 手动命令行启动 | 云端虚拟机自动启动 |
| **API密钥** | 本机环境变量 | GitHub Secrets |
| **访问地址** | `http://localhost:8000` | 内部服务通信 |
| **运行时长** | 持续运行直到手动停止 | 任务完成后自动销毁 |
| **适用场景** | API调试、功能测试 | 实际搜索、训练、邮件发送 |

### **GitHub Actions = 云端临时虚拟机**
```
每次运行 GitHub Actions ≈ 云端重新开机
├── 🖥️ Ubuntu虚拟机 (全新启动)
├── 🐍 Python + 依赖 (自动安装)  
├── 🔑 API密钥 (从Secrets加载)
├── 📊 执行工作流 (搜索/训练/邮件)
├── 💾 保存结果 (artifacts/邮件/GitHub)
└── 🗑️ 销毁环境 (任务完成后)
```

---

## 🚀 步骤1: ChromaDB手动训练

### **1.1 访问GitHub仓库**
```
🌐 打开浏览器访问:
   https://github.com/YefanHuang/creditmonitor
```

### **1.2 启动训练工作流**
```
📋 操作步骤:
1️⃣ 点击 "Actions" 标签页
2️⃣ 在左侧工作流列表中选择 "Unified Training"
3️⃣ 点击 "Run workflow" 下拉按钮
4️⃣ 配置训练参数 (或使用默认值):
   📊 Token限制: 5000
   📁 训练目录: traindb  
   🔄 重新处理: false
5️⃣ 点击绿色 "Run workflow" 按钮
```

### **1.3 监控训练进度**
```
⏱️ 训练监控 (预计3-5分钟):

🟡 排队中 (0-30秒)
   "Queued" → 等待可用的GitHub虚拟机

🔵 初始化 (30-60秒)  
   "Set up job" → 创建Ubuntu虚拟机
   "Checkout repository" → 下载代码
   "Set up Python" → 安装Python环境

🟠 执行中 (2-4分钟)
   "Install dependencies" → 安装依赖包
   "Run ChromaDB Training" → 训练执行
   ├── 读取traindb文件
   ├── 调用千问API向量化  
   ├── 存储到ChromaDB
   └── 更新训练状态

🟢 完成 (总计3-5分钟)
   "Complete job" → 清理环境
   ✅ 显示绿色勾号表示成功
```

### **1.4 训练结果验证**
```
📊 成功指标:
✅ 工作流状态: 绿色勾号
✅ 日志显示: "训练完成" 
✅ 处理文档: 4个征信文档
✅ Token消耗: ~2000 tokens
✅ ChromaDB更新: 新增向量记录

❌ 失败排查:
- API密钥配置错误 → 检查GitHub Secrets
- Token超限 → 增加限制或减少文档
- 网络问题 → 重新运行工作流
```

---

## 🔍 步骤2: 征信信息检索试跑

### **2.1 启动搜索工作流**
```
📋 操作步骤:
1️⃣ 等待训练完成 (绿色勾号)
2️⃣ 在Actions页面选择 "Simple Research Automation"  
3️⃣ 点击 "Run workflow" 配置搜索参数:

📝 推荐配置:
   🎯 研究主题: "征信行业发展趋势" 
   📅 时间过滤: "week" (最近一周)
   📊 Perplexity Token限制: 1000
   🧠 Qwen Token限制: 5000  
   📧 邮件接收地址: 您的邮箱

4️⃣ 点击绿色 "Run workflow" 开始执行
```

### **2.2 监控搜索执行**
```
⏱️ 搜索监控 (预计5-10分钟):

🔵 阶段1: 环境准备 (1-2分钟)
   "Set up job" → 虚拟机初始化
   "Install dependencies" → 环境配置

🟠 阶段2: 搜索执行 (2-3分钟)  
   "Execute Research" → 主要执行阶段
   ├── 🔍 Perplexity API搜索
   ├── ✂️ 智能内容切分和清理
   ├── 🧠 千问API向量化处理
   └── 📊 ChromaDB向量匹配

🟡 阶段3: 结果处理 (1-2分钟)
   ├── 🤖 智能过滤和相关性评分
   ├── 📝 生成结构化报告
   └── 📧 发送邮件通知

🟢 阶段4: 完成清理 (1分钟)
   "Complete job" → 保存artifacts并清理
   ✅ 绿色勾号表示全流程成功
```

### **2.3 实时日志监控**
```
📋 关键日志信息:

🔍 搜索阶段:
   "🔍 开始搜索: 征信行业发展趋势"
   "✅ 找到 3 个原始来源"
   "📊 Perplexity Token使用: 500/1000"

🧠 处理阶段:  
   "🧠 开始智能切分: 1200字符 → 3个段落"
   "📊 向量化完成: 生成384维向量"
   "🎯 ChromaDB匹配: 相关性0.85+"

📧 邮件阶段:
   "📧 生成邮件报告: 包含3个搜索结果"
   "✅ 邮件发送成功: test@example.com" 
   "📊 总Token消耗: 2800/6000"
```

---

## 📧 步骤3: 结果验证和监控

### **3.1 邮件报告内容**
```
📬 您将收到包含以下内容的邮件:

📋 报告结构:
├── 📊 执行摘要
│   ├── 搜索主题: 征信行业发展趋势
│   ├── 时间范围: 最近一周
│   ├── 找到结果: 3个高质量来源
│   └── 相关性评分: 平均0.85+

├── 🔍 详细结果 (每个结果包含):
│   ├── 📄 智能概括内容
│   ├── 🔗 原始Perplexity链接
│   ├── 📚 引用来源列表 (最多5个)
│   ├── 💡 相关问题建议
│   └── 📊 相关性评分

├── 🤖 AI分析洞察:
│   ├── 行业趋势总结
│   ├── 关键发展点
│   └── 风险机会分析

└── 📊 技术统计:
    ├── API调用统计
    ├── Token使用情况
    └── 处理性能指标
```

### **3.2 GitHub Actions监控面板**
```
📊 完整监控检查清单:

✅ 工作流状态:
   - 训练: 🟢 Success (绿色勾号)
   - 搜索: 🟢 Success (绿色勾号)
   - 总时长: 8-15分钟

✅ 资源消耗:
   - Perplexity: ~800 tokens
   - 千问API: ~2200 tokens  
   - 总成本: <$0.50 USD

✅ 输出验证:
   - 邮件发送: ✅ 成功
   - 报告生成: ✅ 3个结果
   - ChromaDB: ✅ 已更新

❌ 常见问题排查:
   - 502错误 → API密钥配置
   - 超时 → Token限制调整
   - 邮件未收到 → SMTP配置检查
   - 无搜索结果 → 主题词调整
```

---

## 🔧 步骤4: 高级监控和调试

### **4.1 详细日志分析**
```
📋 在GitHub Actions中查看详细日志:

1️⃣ 点击具体的工作流运行实例
2️⃣ 展开 "Execute Research" 步骤
3️⃣ 查看实时输出:

🔍 搜索日志示例:
   "🔍 开始Perplexity搜索..."
   "📊 API响应: 200 OK"
   "📝 原始内容: 2500字符"
   "✂️ 清理后内容: 1800字符"

🧠 处理日志示例:
   "🧠 开始智能切分..."
   "📊 切分结果: 3个语义段落"
   "🎯 向量化: 384维 x 3个"
   "📊 ChromaDB查询: 找到2个相关文档"

📧 邮件日志示例:
   "📧 生成HTML报告: 2.5KB"
   "📨 SMTP连接: smtp.163.com:587"
   "✅ 邮件发送: Message-ID xyz123"
```

### **4.2 性能监控指标**
```
⏱️ 关键性能指标:

🚀 执行时间:
   - 搜索阶段: 2-3分钟
   - 处理阶段: 2-4分钟  
   - 邮件阶段: 1-2分钟
   - 总计: 5-10分钟

💰 成本控制:
   - Perplexity: $0.02-0.05/1K tokens
   - 千问API: $0.01-0.03/1K tokens
   - 单次运行: <$0.30 USD
   - 月度预算: <$20 USD (每日1次)

📊 质量指标:
   - 搜索精度: 90%+ 相关性
   - 内容质量: 智能过滤去重
   - 响应速度: 实时监控
   - 错误率: <5%
```

### **4.3 故障排查清单**
```
🛠️ 常见问题快速解决:

❌ API密钥错误:
   解决: 检查GitHub Secrets配置
   验证: 运行 system_diagnostic.py

❌ Token超限:  
   解决: 增加限制参数或减少内容
   监控: 查看日志中的token使用量

❌ 邮件发送失败:
   解决: 检查SMTP配置和邮箱设置
   测试: 运行本地邮件测试脚本

❌ 搜索结果为空:
   解决: 调整搜索主题和时间范围
   优化: 使用更具体的关键词

❌ ChromaDB连接失败:
   解决: 重新运行训练工作流
   验证: 检查训练状态文件
```

---

## 🎯 完整试跑检查清单

### **✅ 试跑前准备**
- [ ] GitHub Secrets已配置 (API密钥、SMTP)
- [ ] 训练数据已准备 (4个征信文档)
- [ ] 网络环境良好
- [ ] 邮箱可正常接收

### **✅ 训练阶段验证** 
- [ ] 启动"Unified Training"工作流
- [ ] 监控执行日志 (3-5分钟)
- [ ] 确认绿色成功状态
- [ ] 检查token消耗合理

### **✅ 搜索阶段验证**
- [ ] 启动"Simple Research Automation"
- [ ] 配置搜索参数
- [ ] 监控执行进度 (5-10分钟) 
- [ ] 验证各阶段日志

### **✅ 结果验证**
- [ ] 收到邮件报告
- [ ] 报告包含3个有效结果
- [ ] 原始链接可访问
- [ ] 相关性评分合理 (>0.8)

### **✅ 系统验证**
- [ ] 总执行时间 <15分钟
- [ ] Token消耗 <6000总计
- [ ] 无错误日志
- [ ] 可重复执行

---

## 🚀 投入使用建议

### **📅 日常使用模式**
```
🔄 建议运行频率:
- 征信政策监控: 每周2-3次
- 行业动态跟踪: 每日1次  
- 专题深度研究: 按需触发
- 竞争对手分析: 每月1-2次
```

### **🎯 搜索主题优化**
```
📝 高效搜索主题示例:
✅ 具体: "个人征信新规政策2024"
✅ 时效: "征信行业并购动态"  
✅ 技术: "区块链征信应用案例"
✅ 监管: "央行征信管理新规"

❌ 避免模糊主题:
❌ "征信" (太宽泛)
❌ "金融" (范围过大)
❌ "风险" (不够具体)
```

### **📊 性能优化建议**
```
⚡ 提升效率:
- 合理设置token限制
- 优化搜索时间范围
- 定期清理训练数据
- 监控API配额使用

💰 成本控制:
- 避免重复搜索相同主题
- 合理设置搜索频率
- 利用ChromaDB缓存机制
- 定期评估API使用效率
```

---

**🎉 试跑完成后，您就拥有了一个完全自动化的征信研究系统！**

系统将持续为您提供：
- 🔍 实时行业动态监控
- 🧠 智能内容分析过滤  
- 📊 相关性评分排序
- 📧 结构化邮件报告
- 💾 知识库持续增强