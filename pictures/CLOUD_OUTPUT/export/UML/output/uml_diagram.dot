// Credit Research System UML Diagram with Components
digraph uml_diagram {
	bgcolor=white fontname=Arial fontsize=10 label="信用研究自动化系统 - UML类图" labelloc=top rankdir=TB
	node [fontname=Arial fontsize=10 shape=record style=filled]
	edge [fontname=Arial fontsize=8]
	ModelConfig [label="{&lt;&lt;DataClass&gt;&gt;\nModelConfig}|{+ alias\l+ provider\l+ model_id\l+ model_type\l+ api_key\l...\l}" fillcolor=lightgreen tooltip="Class: ModelConfig"]
	ModelRegistry [label="{&lt;&lt;DataClass&gt;&gt;\nModelRegistry}|{+ models\l}|{+ register_model()\l+ get_model()\l+ get_models_by_type()\l+ get_models_by_provider()\l}" fillcolor=lightgreen tooltip="模型注册表 - 管理所有可用模型"]
	APIConfig [label="{&lt;&lt;DataClass&gt;&gt;\nAPIConfig}|{+ perplexity_api_key\l+ default_chat_model\l+ default_embedding_model\l+ model_registry\l}|{+ get_available_providers()\l+ get_available_models()\l+ validate_config()\l}" fillcolor=lightgreen tooltip="API配置类 - 支持多种API提供商和模型"]
	EmailConfig [label="{&lt;&lt;DataClass&gt;&gt;\nEmailConfig}|{+ email_user\l+ email_pass\l+ email_to\l+ smtp_server\l+ smtp_port\l}" fillcolor=lightgreen tooltip="邮件配置类"]
	SearchConfig [label="{&lt;&lt;DataClass&gt;&gt;\nSearchConfig}|{+ search_topics\l+ time_filter\l+ max_results_per_topic\l}" fillcolor=lightgreen tooltip="搜索配置类"]
	FilterConfig [label="{&lt;&lt;DataClass&gt;&gt;\nFilterConfig}|{+ vector_similarity_top_k\l+ final_selection_count\l+ content_max_length\l}" fillcolor=lightgreen tooltip="筛选配置类"]
	ConfigManager [label="{ConfigManager}|{+ __init__()\l+ validate_config()\l+ get_available_apis()\l+ print_config_summary()\l}" fillcolor=lightblue tooltip="配置管理器"]
	SearchManager [label="{SearchManager}|{+ __init__()\l+ search_topic()\l+ search_multiple_topics()\l+ save_results()\l+ load_results()\l+ test_connection()\l...\l}" fillcolor=lightblue tooltip="搜索管理器"]
	UnifiedChromaDBTrainer [label="{UnifiedChromaDBTrainer}|{+ __init__()\l+ get_file_hash()\l+ load_processed_files()\l+ save_processed_files()\l}" fillcolor=lightblue tooltip="统一ChromaDB训练器"]
	CreditResearchSystem [label="{CreditResearchSystem}|{+ __init__()\l+ search_manager()\l+ embedding_manager()\l+ filter_manager()\l+ email_manager()\l+ test_system()\l...\l}" fillcolor=lightblue tooltip="信用研究自动化系统 - 使用聚合模式重构"]
	ResearchClient [label="{ResearchClient}|{+ __init__()\l}" fillcolor=lightblue tooltip="研究API客户端 - 替代原来的CreditResearchSystem"]
	SyncResearchClient [label="{SyncResearchClient}|{+ __init__()\l+ health_check()\l+ search()\l+ filter_documents()\l+ send_email()\l+ execute_research()\l}" fillcolor=lightblue tooltip="同步版本的研究客户端 - 为了兼容现有同步代码"]
	EmailManager [label="{EmailManager}|{+ __init__()\l+ format_email_content()\l+ send_email()\l+ send_filter_results()\l+ test_connection()\l+ send_test_email()\l...\l}" fillcolor=lightblue tooltip="邮件管理器"]
	TokenUsage [label="{&lt;&lt;DataClass&gt;&gt;\nTokenUsage}|{+ api_provider\l+ model\l+ input_tokens\l+ output_tokens\l+ total_tokens\l...\l}" fillcolor=lightgreen tooltip="Token使用情况"]
	TokenLimit [label="{&lt;&lt;DataClass&gt;&gt;\nTokenLimit}|{+ api_provider\l+ total_limit\l+ current_usage\l+ cost_limit_usd\l+ current_cost_usd\l}" fillcolor=lightgreen tooltip="Token限制配置"]
	RealtimeTokenMonitor [label="{RealtimeTokenMonitor}|{+ __init__()\l+ set_token_limit()\l+ log_token_usage()\l+ start_monitoring()\l+ stop_monitoring()\l+ register_callback()\l...\l}" fillcolor=lightblue tooltip="实时Token监控器"]
	ModelType [label="{ModelType}|{+ LLM\l+ EMBEDDING\l+ SEARCH\l}" fillcolor=lightblue tooltip="Class: ModelType"]
	UnifiedModelManager [label="{UnifiedModelManager}|{+ __init__()\l+ register_model()\l+ get_model()\l+ get_client()\l+ get_model_status()\l}" fillcolor=lightblue tooltip="统一模型管理器 - 基于OpenAI SDK的成功模式"]
	TaskType [label="{TaskType}|{+ SEARCH\l+ VECTORIZATION\l+ TEXT_PROCESSING\l+ TRAINING\l+ EMAIL_SENDING\l...\l}" fillcolor=lightblue tooltip="任务类型枚举"]
	ProgressAlgorithm [label="{ProgressAlgorithm}|{+ TEXT_BASED\l+ COUNT_BASED\l+ TOKEN_BASED\l+ HYBRID\l}" fillcolor=lightblue tooltip="进度计算算法"]
	TaskProgress [label="{&lt;&lt;DataClass&gt;&gt;\nTaskProgress}|{+ task_id\l+ task_type\l+ total_items\l+ processed_items\l+ total_tokens\l...\l}|{+ percentage()\l+ token_percentage()\l+ text_percentage()\l+ elapsed_time()\l+ eta()\l}" fillcolor=lightgreen tooltip="任务进度数据结构"]
	TokenEstimate [label="{&lt;&lt;DataClass&gt;&gt;\nTokenEstimate}|{+ task_id\l+ task_type\l+ api_provider\l+ estimated_input_tokens\l+ estimated_output_tokens\l...\l}|{+ to_dict()\l}" fillcolor=lightgreen tooltip="Token消耗估算数据结构"]
	ProgressManager [label="{ProgressManager}|{+ __init__()\l+ create_task()\l+ update_progress()\l+ estimate_tokens()\l+ log_api_usage()\l+ complete_task()\l...\l}" fillcolor=lightblue tooltip="统一的进度与Token管理器"]
	SearchResultProcessor [label="{SearchResultProcessor}|{+ __init__()\l}" fillcolor=lightblue tooltip="搜索结果处理器 - 高级文本处理和向量匹配"]
	ComponentProtocol [label="{ComponentProtocol}|{+ test_connection()\l+ get_status()\l}" fillcolor=lightblue tooltip="组件协议接口"]
	ComponentAggregator [label="{ComponentAggregator}|{+ __init__()\l+ get_component()\l+ is_component_ready()\l+ test_all_components()\l+ get_system_status()\l+ save_status_report()\l...\l}" fillcolor=lightblue tooltip="组件聚合器 - 管理所有系统组件的生命周期"]
	ModelConfig -> ModelType [label=uses arrowhead=open color=gray style=dashed]
	ModelRegistry -> ModelConfig [label=uses arrowhead=open color=gray style=dashed]
	APIConfig -> ModelRegistry [label=uses arrowhead=open color=gray style=dashed]
	APIConfig -> ModelConfig [label=uses arrowhead=open color=gray style=dashed]
	ConfigManager -> ModelConfig [label=configures arrowhead=odiamond color=orange penwidth=2 style=solid]
	ConfigManager -> APIConfig [label=configures arrowhead=odiamond color=orange penwidth=2 style=solid]
	ConfigManager -> EmailConfig [label=configures arrowhead=odiamond color=orange penwidth=2 style=solid]
	ConfigManager -> SearchConfig [label=configures arrowhead=odiamond color=orange penwidth=2 style=solid]
	ConfigManager -> FilterConfig [label=configures arrowhead=odiamond color=orange penwidth=2 style=solid]
	CreditResearchSystem -> ConfigManager [label=accesses arrowhead=open color=gray style=dashed]
	CreditResearchSystem -> SearchManager [label=accesses arrowhead=open color=gray style=dashed]
	CreditResearchSystem -> EmailManager [label=accesses arrowhead=open color=gray style=dashed]
	CreditResearchSystem -> UnifiedModelManager [label=accesses arrowhead=open color=gray style=dashed]
	CreditResearchSystem -> ProgressManager [label=accesses arrowhead=open color=gray style=dashed]
	CreditResearchSystem -> ComponentAggregator [label=uses arrowhead=open color=gray style=dashed]
	SyncResearchClient -> ResearchClient [label=uses arrowhead=open color=gray style=dashed]
	RealtimeTokenMonitor -> TokenUsage [label=uses arrowhead=open color=gray style=dashed]
	RealtimeTokenMonitor -> TokenLimit [label=uses arrowhead=open color=gray style=dashed]
	UnifiedModelManager -> ModelType [label=uses arrowhead=open color=gray style=dashed]
	UnifiedModelManager -> ModelConfig [label=uses arrowhead=open color=gray style=dashed]
	TaskProgress -> TaskType [label=uses arrowhead=open color=gray style=dashed]
	TokenEstimate -> TaskType [label=uses arrowhead=open color=gray style=dashed]
	ProgressManager -> TaskProgress [label=uses arrowhead=open color=gray style=dashed]
	ProgressManager -> ProgressAlgorithm [label=uses arrowhead=open color=gray style=dashed]
	ProgressManager -> TokenEstimate [label=uses arrowhead=open color=gray style=dashed]
	ProgressManager -> TaskType [label=uses arrowhead=open color=gray style=dashed]
	ConfigManager -> ComponentProtocol [label=implements arrowhead=open color=gray style=dashed]
	SearchManager -> ComponentProtocol [label=implements arrowhead=open color=gray style=dashed]
	EmailManager -> ComponentProtocol [label=implements arrowhead=open color=gray style=dashed]
	UnifiedModelManager -> ComponentProtocol [label=implements arrowhead=open color=gray style=dashed]
	ProgressManager -> ComponentProtocol [label=implements arrowhead=open color=gray style=dashed]
	ComponentAggregator -> ConfigManager [label=manages arrowhead=odiamond color=orange penwidth=2 style=solid]
	ComponentAggregator -> SearchManager [label=manages arrowhead=odiamond color=orange penwidth=2 style=solid]
	ComponentAggregator -> EmailManager [label=manages arrowhead=odiamond color=orange penwidth=2 style=solid]
	ComponentAggregator -> UnifiedModelManager [label=manages arrowhead=odiamond color=orange penwidth=2 style=solid]
	ComponentAggregator -> ProgressManager [label=manages arrowhead=odiamond color=orange penwidth=2 style=solid]
}
